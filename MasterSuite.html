<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Suite - Final v16</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0505;
            --glass: rgba(25, 20, 20, 0.85);
            --border: rgba(255, 255, 255, 0.08);
            --primary: #f97316;
            --accent: #a855f7;
        }
        
        body {
            background-color: var(--bg-dark);
            color: #ffffff;
            font-family: 'Outfit', sans-serif;
            overflow: hidden;
            margin: 0;
            user-select: none;
        }

        /* Loading & Overlays */
        #intro-screen {
            position: fixed;
            inset: 0;
            z-index: 10000;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease;
        }

        #processing-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        
        #processing-overlay.visible { opacity: 1; pointer-events: auto; }

        /* Dynamic Background */
        #bg-fx {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: radial-gradient(circle at 50% 50%, #2a1010 0%, #000 80%);
            animation: pulseBg 10s infinite alternate;
        }

        @keyframes pulseBg {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        /* Glass Panel */
        .glass {
            background: var(--glass);
            backdrop-filter: blur(40px);
            border: 1px solid var(--border);
        }

        /* Layout */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            height: 100vh;
        }

        @media (max-width: 1024px) {
            .app-grid {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 450px;
            }
        }

        /* Canvas Area */
        .viewport {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            overflow: hidden;
            position: relative;
        }

        #frame-wrap {
            position: relative;
            box-shadow: 0 0 100px rgba(0,0,0,0.9);
            max-width: 100%;
            max-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.05);
        }

        canvas {
            max-width: 100%;
            max-height: 85vh;
            display: block;
            object-fit: contain;
        }

        /* Controls */
        .grad-track {
            height: 36px;
            width: 100%;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            cursor: crosshair;
            margin-bottom: 20px;
            background: #111;
        }

        .dot {
            width: 24px;
            height: 24px;
            border: 3px solid #fff;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 10;
            transition: transform 0.1s;
        }

        .dot.active {
            border-color: var(--primary);
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 20;
            box-shadow: 0 0 15px var(--primary);
        }

        /* Sliders */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { height: 6px; background: rgba(255,255,255,0.1); border-radius: 4px; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%;
            background: #fff; margin-top: -5px; cursor: pointer; box-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        .loader-spin {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 24px; height: 24px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="bg-fx"></div>

    <!-- Intro -->
    <div id="intro-screen">
        <div class="relative w-24 h-24 mb-6">
            <div class="absolute inset-0 border-4 border-white/5 rounded-full"></div>
            <div class="absolute inset-0 border-t-4 border-orange-500 rounded-full animate-spin"></div>
        </div>
        <h1 class="text-4xl font-black italic tracking-tighter mb-1 uppercase">Master<span class="text-orange-500">Suite</span></h1>
        <p class="text-[10px] tracking-[0.6em] text-gray-500 uppercase mb-12">v16 Final Edition</p>
        <button id="btn-enter" class="opacity-0 translate-y-4 px-10 py-3 bg-white/5 border border-white/10 hover:bg-white/10 rounded-full font-bold text-xs tracking-widest uppercase transition-all duration-700">Mulai Editor</button>
    </div>

    <div class="app-grid">
        <!-- Main Area -->
        <div class="flex flex-col overflow-hidden relative z-10">
            <header class="h-16 flex items-center justify-between px-6 glass border-none border-b border-white/5">
                <div class="flex items-center gap-4">
                    <div class="flex flex-col">
                        <span class="text-[9px] font-black text-orange-500 uppercase tracking-widest">Master Suite</span>
                        <span id="res-info" class="text-[10px] font-bold text-gray-400">Siap</span>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <label for="file-in" class="bg-orange-600 hover:bg-orange-500 text-white px-5 py-2 rounded-lg text-[10px] font-bold cursor-pointer transition-all uppercase tracking-widest shadow-lg shadow-orange-600/20">Import</label>
                    <input type="file" id="file-in" class="hidden" accept="image/*">
                    <button id="btn-save" class="bg-white/5 hover:bg-white/10 border border-white/10 text-white px-5 py-2 rounded-lg text-[10px] font-bold transition-all uppercase tracking-widest">Ekspor</button>
                </div>
            </header>

            <div class="viewport">
                <div id="frame-wrap">
                    <div id="processing-overlay">
                        <div class="loader-spin mb-2"></div>
                        <span class="text-[10px] font-bold tracking-widest uppercase">Memproses...</span>
                    </div>

                    <div id="placeholder" class="text-center p-12 opacity-30">
                        <svg class="mx-auto mb-4" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                        <p class="text-[10px] font-bold uppercase tracking-widest">Unggah Foto</p>
                    </div>
                    <canvas id="canvas" class="hidden"></canvas>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <aside class="glass flex flex-col p-6 overflow-y-auto border-none border-l border-white/5 z-20">
            
            <!-- Gradient Control -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]">Color Map</h2>
                    <div class="flex gap-2">
                         <button id="btn-add" class="flex items-center gap-1 bg-white/5 hover:bg-white/10 text-gray-300 px-3 py-1.5 rounded-md border border-white/10 transition-all">
                            <span class="text-[10px] font-bold uppercase">+ Add</span>
                        </button>
                        <button id="btn-del" class="flex items-center gap-1 bg-red-500/10 hover:bg-red-500/20 text-red-400 px-3 py-1.5 rounded-md border border-red-500/20 transition-all opacity-50 cursor-not-allowed">
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6L6 18M6 6l12 12"/></svg>
                        </button>
                    </div>
                </div>

                <div id="grad-track" class="grad-track">
                    <div id="stops-container" class="absolute inset-0 pointer-events-none"></div>
                </div>

                <!-- Stop Editor -->
                <div id="stop-editor" class="hidden p-3 bg-white/5 rounded-xl border border-white/5 space-y-3">
                    <div class="flex items-center gap-3">
                        <input type="color" id="in-color" class="w-8 h-8 bg-transparent border-none cursor-pointer rounded-md overflow-hidden p-0">
                        <div class="flex-1">
                            <div class="flex justify-between text-[10px] font-bold mb-1">
                                <span class="text-gray-500 uppercase">Pos</span>
                                <span id="lbl-pos" class="text-orange-500">50%</span>
                            </div>
                            <input type="range" id="in-pos" min="0" max="100">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Extended Lighting & Atmos -->
            <div class="space-y-4 border-t border-white/5 pt-6">
                <h2 class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-2">Atmosfer & Cahaya</h2>

                <!-- Toggles -->
                <div class="grid grid-cols-2 gap-2">
                    <div class="flex items-center justify-between p-3 bg-amber-900/10 border border-amber-500/10 rounded-lg">
                        <p class="text-[10px] font-bold text-amber-500 uppercase">Oil</p>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="oil-check" class="sr-only peer">
                            <div class="w-7 h-4 bg-white/10 rounded-full peer peer-checked:bg-amber-600 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-3"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-blue-900/10 border border-blue-500/10 rounded-lg">
                        <p class="text-[10px] font-bold text-blue-400 uppercase">Water</p>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="wc-check" class="sr-only peer">
                            <div class="w-7 h-4 bg-white/10 rounded-full peer peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-3"></div>
                        </label>
                    </div>
                </div>

                <!-- Sliders -->
                <div class="space-y-4 pt-2">
                     <div class="space-y-1">
                        <div class="flex justify-between text-[10px] font-black uppercase">
                            <span class="text-gray-500">Vignette (Gelap Tepi)</span>
                            <span id="lbl-vig" class="text-white">0%</span>
                        </div>
                        <input type="range" id="in-vig" min="0" max="100" value="0">
                    </div>
                     <div class="space-y-1">
                        <div class="flex justify-between text-[10px] font-black uppercase">
                            <span class="text-gray-500">Gamma / Exposure</span>
                            <span id="lbl-gamma" class="text-white">1.0</span>
                        </div>
                        <input type="range" id="in-gamma" min="50" max="200" value="100">
                    </div>
                     <div class="space-y-1">
                        <div class="flex justify-between text-[10px] font-black uppercase">
                            <span class="text-gray-500">Map Intensity</span>
                            <span id="lbl-int" class="text-white">100%</span>
                        </div>
                        <input type="range" id="in-int" min="0" max="100" value="100">
                    </div>
                </div>
            </div>

            <!-- New Presets -->
            <div class="mt-auto pt-8">
                <h2 class="text-[10px] font-black text-gray-400 uppercase tracking-[0.2em] mb-3">Koleksi Musiman</h2>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <button onclick="applyPreset('autumn')" class="py-3 text-[9px] font-black uppercase bg-orange-900/20 border border-orange-500/20 text-orange-200 rounded hover:bg-orange-600 transition-all">üçÇ Autumn</button>
                    <button onclick="applyPreset('halloween')" class="py-3 text-[9px] font-black uppercase bg-purple-900/20 border border-purple-500/20 text-purple-200 rounded hover:bg-purple-600 transition-all">üéÉ Halloween</button>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="applyPreset('cyber')" class="py-2 text-[8px] font-bold uppercase bg-white/5 border border-white/10 rounded hover:bg-blue-600 transition-all">Cyber</button>
                    <button onclick="applyPreset('oil')" class="py-2 text-[8px] font-bold uppercase bg-white/5 border border-white/10 rounded hover:bg-amber-600 transition-all">Oil</button>
                    <button onclick="applyPreset('noir')" class="py-2 text-[8px] font-bold uppercase bg-white/5 border border-white/10 rounded hover:bg-gray-600 transition-all">Noir</button>
                </div>
            </div>
        </aside>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const overlay = document.getElementById('processing-overlay');
        
        let originalImg = null;
        let originalFileName = 'image'; // Default name
        let stops = [{id: 1, pos: 0, color: '#000000'}, {id: 2, pos: 100, color: '#ffffff'}];
        let activeId = null;
        let renderTimeout;

        // INIT
        window.onload = () => setTimeout(() => document.getElementById('btn-enter').classList.remove('opacity-0', 'translate-y-4'), 500);
        document.getElementById('btn-enter').onclick = () => {
            document.getElementById('intro-screen').style.opacity = '0';
            setTimeout(() => document.getElementById('intro-screen').remove(), 800);
        };

        // FILE
        document.getElementById('file-in').onchange = (e) => {
            const f = e.target.files[0];
            if(!f) return;
            
            // Simpan nama file asli tanpa ekstensi
            originalFileName = f.name.replace(/\.[^/.]+$/, "");
            
            const r = new FileReader();
            r.onload = (v) => {
                const img = new Image();
                img.onload = () => {
                    originalImg = img;
                    canvas.width = img.width; canvas.height = img.height;
                    canvas.classList.remove('hidden');
                    document.getElementById('placeholder').classList.add('hidden');
                    document.getElementById('res-info').innerText = `${img.width}x${img.height} PX`;
                    requestRender();
                };
                img.src = v.target.result;
            };
            r.readAsDataURL(f);
        };

        // STOPS
        function addStop(pos = 50) {
            const id = Date.now();
            stops.push({id, pos, color: '#808080'});
            activeId = id;
            updateUI();
            requestRender();
        }

        document.getElementById('grad-track').onclick = (e) => {
            if(e.target !== e.currentTarget) return;
            const rect = e.target.getBoundingClientRect();
            addStop(Math.max(0, Math.min(100, ((e.clientX - rect.left) / rect.width) * 100)));
        };

        document.getElementById('btn-add').onclick = () => addStop(50);
        document.getElementById('btn-del').onclick = () => {
            if(stops.length > 2 && activeId) {
                stops = stops.filter(s => s.id !== activeId);
                activeId = null;
                updateUI();
                requestRender();
            }
        };

        // RENDER ENGINE
        function requestRender() {
            overlay.classList.add('visible');
            clearTimeout(renderTimeout);
            renderTimeout = setTimeout(async () => {
                await processImage();
                overlay.classList.remove('visible');
            }, 50);
        }

        async function processImage() {
            if(!originalImg) return;
            return new Promise((resolve) => {
                ctx.drawImage(originalImg, 0, 0);

                const isOil = document.getElementById('oil-check').checked;
                const isWC = document.getElementById('wc-check').checked;

                // 1. Heavy Filters
                if(isOil) {
                    ctx.filter = 'blur(2px) contrast(1.3)';
                    ctx.drawImage(canvas, 0, 0);
                    ctx.filter = 'none';
                }
                if(isWC) {
                    ctx.globalAlpha = 0.6;
                    ctx.filter = 'blur(4px) saturate(1.4)';
                    ctx.drawImage(canvas, 0, 0);
                    ctx.globalAlpha = 0.4;
                    ctx.filter = 'contrast(1.4)';
                    ctx.drawImage(canvas, 0, 0);
                    ctx.globalAlpha = 1.0;
                    ctx.filter = 'none';
                }

                // 2. Pixel Processing
                const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
                const d = imgData.data;
                const int = document.getElementById('in-int').value / 100;
                const gamma = document.getElementById('in-gamma').value / 100;
                const quantize = isOil ? 32 : 1;

                // LUT Generation
                const lut = new Uint8ClampedArray(256 * 3);
                stops.sort((a,b) => a.pos - b.pos);
                for(let i=0; i<256; i++) {
                    const c = getCol(i);
                    lut[i*3] = c.r; lut[i*3+1] = c.g; lut[i*3+2] = c.b;
                }

                for(let i=0; i<d.length; i+=4) {
                    let r = d[i], g = d[i+1], b = d[i+2];

                    if(isOil) {
                        r = (r/quantize | 0) * quantize;
                        g = (g/quantize | 0) * quantize;
                        b = (b/quantize | 0) * quantize;
                    }

                    // Gamma Correction (Lighting)
                    if(gamma !== 1.0) {
                        r = 255 * Math.pow(r / 255, 1/gamma);
                        g = 255 * Math.pow(g / 255, 1/gamma);
                        b = 255 * Math.pow(b / 255, 1/gamma);
                    }

                    // Color Mapping
                    const lum = (r*0.299 + g*0.587 + b*0.114) | 0;
                    const idx = lum * 3;
                    
                    d[i] = r*(1-int) + lut[idx]*int;
                    d[i+1] = g*(1-int) + lut[idx+1]*int;
                    d[i+2] = b*(1-int) + lut[idx+2]*int;
                }
                ctx.putImageData(imgData, 0, 0);

                // 3. Vignette Overlay (Extended Feature)
                const vigStr = document.getElementById('in-vig').value / 100;
                if(vigStr > 0) {
                    ctx.globalCompositeOperation = 'multiply';
                    const grad = ctx.createRadialGradient(
                        canvas.width/2, canvas.height/2, canvas.width/4,
                        canvas.width/2, canvas.height/2, canvas.width
                    );
                    grad.addColorStop(0, `rgba(0,0,0,0)`);
                    grad.addColorStop(1, `rgba(0,0,0,${vigStr})`);
                    ctx.fillStyle = grad;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.globalCompositeOperation = 'source-over';
                }

                resolve();
            });
        }

        function getCol(l) {
            const p = (l/255)*100;
            let lS = stops[0], rS = stops[stops.length-1];
            for(let i=0; i<stops.length-1; i++) {
                if(p >= stops[i].pos && p <= stops[i+1].pos) { lS = stops[i]; rS = stops[i+1]; break; }
            }
            const f = (p - lS.pos) / (rS.pos - lS.pos || 1);
            const c1 = h2r(lS.color), c2 = h2r(rS.color);
            return {
                r: c1.r + (c2.r-c1.r)*f,
                g: c1.g + (c2.g-c1.g)*f,
                b: c1.b + (c2.b-c1.b)*f
            };
        }
        function h2r(h) { return { r: parseInt(h.slice(1,3),16), g: parseInt(h.slice(3,5),16), b: parseInt(h.slice(5,7),16) }; }

        // UI
        function updateUI() {
            stops.sort((a,b) => a.pos - b.pos);
            const css = stops.map(s => `${s.color} ${s.pos}%`).join(',');
            document.getElementById('grad-track').style.background = `linear-gradient(to right, ${css})`;
            
            const root = document.getElementById('stops-container');
            root.innerHTML = '';
            root.style.pointerEvents = 'auto';

            stops.forEach(s => {
                const dot = document.createElement('div');
                dot.className = `dot ${activeId === s.id ? 'active' : ''}`;
                dot.style.left = s.pos + '%';
                dot.style.backgroundColor = s.color;
                
                const onMove = (me) => {
                    const rect = document.getElementById('grad-track').getBoundingClientRect();
                    const cx = me.touches ? me.touches[0].clientX : me.clientX;
                    s.pos = Math.max(0, Math.min(100, ((cx - rect.left)/rect.width)*100));
                    updateUI();
                };

                const start = (e) => {
                    e.stopPropagation();
                    activeId = s.id;
                    window.addEventListener('mousemove', onMove);
                    window.addEventListener('mouseup', () => { 
                        window.removeEventListener('mousemove', onMove);
                        requestRender();
                    }, {once:true});
                    window.addEventListener('touchmove', onMove);
                    window.addEventListener('touchend', () => {
                         window.removeEventListener('touchmove', onMove);
                         requestRender();
                    }, {once:true});
                    updateUI();
                };
                
                dot.onmousedown = start;
                dot.ontouchstart = start;
                root.appendChild(dot);
            });

            const btnDel = document.getElementById('btn-del');
            if(activeId && stops.length > 2) {
                btnDel.classList.remove('opacity-50', 'cursor-not-allowed');
                btnDel.classList.add('hover:bg-red-500/20');
            } else {
                btnDel.classList.add('opacity-50', 'cursor-not-allowed');
                btnDel.classList.remove('hover:bg-red-500/20');
            }

            const active = stops.find(x => x.id === activeId);
            const editor = document.getElementById('stop-editor');
            if(active) {
                editor.classList.remove('hidden');
                document.getElementById('in-color').value = active.color;
                document.getElementById('in-pos').value = active.pos;
                document.getElementById('lbl-pos').innerText = Math.round(active.pos) + '%';
            } else {
                editor.classList.add('hidden');
            }
        }

        // INPUTS
        document.getElementById('in-color').oninput = (e) => {
            const s = stops.find(x => x.id === activeId);
            if(s) { s.color = e.target.value; updateUI(); requestRender(); }
        };
        document.getElementById('in-pos').oninput = (e) => {
            const s = stops.find(x => x.id === activeId);
            if(s) { s.pos = e.target.value; updateUI(); }
        };
        document.getElementById('in-pos').onchange = () => requestRender();

        document.getElementById('in-int').oninput = (e) => document.getElementById('lbl-int').innerText = e.target.value + '%';
        document.getElementById('in-int').onchange = requestRender;

        document.getElementById('in-vig').oninput = (e) => document.getElementById('lbl-vig').innerText = e.target.value + '%';
        document.getElementById('in-vig').onchange = requestRender;

        document.getElementById('in-gamma').oninput = (e) => document.getElementById('lbl-gamma').innerText = (e.target.value/100).toFixed(1);
        document.getElementById('in-gamma').onchange = requestRender;

        document.getElementById('oil-check').onchange = requestRender;
        document.getElementById('wc-check').onchange = requestRender;

        function applyPreset(t) {
            const ps = {
                autumn: [{id:1,pos:0,color:'#2c0b0e'},{id:2,pos:40,color:'#7c2d12'},{id:3,pos:80,color:'#d97706'},{id:4,pos:100,color:'#fef3c7'}],
                halloween: [{id:1,pos:0,color:'#0f0518'},{id:2,pos:30,color:'#4c1d95'},{id:3,pos:70,color:'#ea580c'},{id:4,pos:100,color:'#a3e635'}],
                cyber: [{id:1,pos:0,color:'#000000'},{id:2,pos:50,color:'#ff00ff'},{id:3,pos:100,color:'#00ffff'}],
                oil: [{id:1,pos:0,color:'#1a1000'},{id:2,pos:50,color:'#b38600'},{id:3,pos:100,color:'#ffefcc'}],
                noir: [{id:1,pos:0,color:'#000000'},{id:2,pos:50,color:'#666666'},{id:3,pos:100,color:'#ffffff'}]
            };
            stops = JSON.parse(JSON.stringify(ps[t]));
            activeId = null;
            
            document.getElementById('oil-check').checked = (t === 'oil' || t === 'autumn');
            document.getElementById('in-vig').value = (t === 'halloween') ? 60 : 0;
            document.getElementById('in-gamma').value = (t === 'autumn') ? 110 : 100;
            
            updateUI();
            requestRender();
        }

        // SAVE BUTTON (UPDATED)
        document.getElementById('btn-save').onclick = () => {
            if(!originalImg) return;
            const a = document.createElement('a');
            a.download = `${originalFileName}_MasterSuite.png`; // Nama file asli + suffix
            a.href = canvas.toDataURL();
            a.click();
        };

        updateUI();
    </script>
</body>
</html>

